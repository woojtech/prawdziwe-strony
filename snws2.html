<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="icon" type="image/png" href="./favicon.png"/>
    <meta charset="UTF-8">
    <title>Symulator Nurkowania w Szambie</title>
    <style>
        body { background: #1a0f00; margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; }
        canvas { display: block; background: linear-gradient(#5d4037, #22150b); margin: 0 auto; border: 3px solid #3d2b1f; }
        
        /* Ekrany menu */
        .overlay-screen {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; z-index: 100;
        }
        
        h1 { color: #ffeb3b; font-size: 42px; text-shadow: 3px 3px #5d3a1a; margin-bottom: 10px; }
        p { font-size: 18px; max-width: 600px; line-height: 1.6; }
        
        .btn-group { display: flex; gap: 20px; margin-top: 30px; }
        button {
            padding: 15px 40px; font-size: 20px; cursor: pointer;
            background: #8d6e63; color: white; border: none; border-radius: 8px;
            transition: 0.2s; font-weight: bold;
        }
        button:hover { background: #a1887f; transform: scale(1.05); }
        button.play { background: #4CAF50; }

        /* UI Gry */
        #game-ui { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); text-align: center; pointer-events: none; display: none; width: 100%; }
        .stats { display: flex; justify-content: center; gap: 30px; font-size: 22px; text-shadow: 2px 2px 4px #000; }
        #oxygen-cont { width: 300px; height: 12px; background: #333; border: 2px solid #fff; margin: 8px auto; border-radius: 10px; overflow: hidden; }
        #oxygen-bar { height: 100%; background: #00d4ff; width: 100%; }
        
        #instruction-screen { display: none; }
        #game-over-screen { display: none; }
    </style>
</head>
<body>

<!-- EKRAN STARTOWY -->
<div id="start-screen" class="overlay-screen">
    <h1>SYMULATOR NURKOWANIA W SZAMBIE</h1>
    <p>Zbieraj bia≈Çy papier toaletowy i niebieskie bƒÖbelki powietrza,<br>unikaj brƒÖzowych kup i ≈º√≥≈Çtego siusiu!</p>
    <div class="btn-group">
        <button class="play" onclick="startGame()">GRAJ</button>
        <button onclick="showInstructions()">INSTRUKCJA</button>
    </div>
</div>

<!-- EKRAN INSTRUKCJI -->
<div id="instruction-screen" class="overlay-screen">
    <h1>INSTRUKCJA</h1>
    <p>
        <strong>RUCH:</strong> Klawisze WSAD lub STRZA≈ÅKI<br>
        <strong>SKLEP:</strong> Klawisz [1] kupuje szczotkƒô (15 rolek) i jƒÖ aktywuje<br>
        <strong>SZCZOTKA:</strong> Niszczy kupy i siki przez 5 sekund!<br>
        <strong>WYNURZENIE:</strong> SPACJA (ko≈Ñczy grƒô i zapisuje wynik)<br><br>
        <em>Nie daj siƒô poch≈ÇonƒÖƒá mƒôtnej otch≈Çani!</em>
    </p>
    <button onclick="showStart()">POWR√ìT</button>
</div>

<!-- EKRAN KO≈ÉCOWY -->
<div id="game-over-screen" class="overlay-screen">
    <h1 id="over-title">KONIEC</h1>
    <p id="over-msg"></p>
    <button onclick="location.reload()">MENU G≈Å√ìWNE</button>
</div>

<!-- UI GRY -->
<div id="game-ui">
    <div class="stats">
        <div>üßª <span id="score">0</span></div>
        <div>ü™† <span id="brushes">0</span></div>
        <div>G≈Çƒôboko≈õƒá: <span id="depth">0</span>m</div>
    </div>
    <div id="oxygen-cont"><div id="oxygen-bar"></div></div>
    <div id="status-msg" style="color: #ffeb3b; font-weight: bold; height: 20px;"></div>
</div>

<canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = 600;
    canvas.height = window.innerHeight;

    let player = { x: 280, y: 100, w: 40, h: 60, oxygen: 100, score: 0, depth: 0, brushes: 0, powerUpActive: false };
    let objects = [];
    let gameRunning = false;
    let keys = {};

    const drawFns = {
        poop: (x, y) => {
            ctx.fillStyle = '#5d3a1a'; ctx.beginPath(); ctx.moveTo(x, y);
            ctx.bezierCurveTo(x-20, y+10, x-20, y+30, x, y+30);
            ctx.bezierCurveTo(x+20, y+30, x+20, y+10, x, y); ctx.fill();
        },
        pee: (x, y) => {
            ctx.fillStyle = 'rgba(255, 235, 59, 0.4)';
            ctx.beginPath(); ctx.ellipse(x, y, 35, 18, 0, 0, Math.PI * 2); ctx.fill();
        },
        paper: (x, y) => {
            ctx.fillStyle = '#fff'; ctx.fillRect(x-10, y-12, 20, 24);
            ctx.fillStyle = '#ddd'; ctx.beginPath(); ctx.ellipse(x, y+12, 10, 5, 0, 0, Math.PI * 2); ctx.fill();
        },
        air: (x, y) => {
            ctx.strokeStyle = '#00d4ff'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(x, y, 12, 0, Math.PI*2); ctx.stroke();
            ctx.fillStyle = 'rgba(0, 212, 255, 0.2)'; ctx.fill();
        }
    };

    window.addEventListener('keydown', e => {
        keys[e.code] = true;
        if(gameRunning) {
            if(e.key === '1') {
                if(!player.powerUpActive && player.brushes > 0) activateBrush();
                else if(player.score >= 15) { player.score -= 15; player.brushes++; }
            }
            if(e.code === 'Space') finish(true);
        }
    });
    window.addEventListener('keyup', e => keys[e.code] = false);

    function showInstructions() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('instruction-screen').style.display = 'flex';
    }

    function showStart() {
        document.getElementById('instruction-screen').style.display = 'none';
        document.getElementById('start-screen').style.display = 'flex';
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'block';
        gameRunning = true;
        update();
        draw();
    }

    function activateBrush() {
        player.brushes--;
        player.powerUpActive = true;
        document.getElementById('status-msg').innerText = "SZCZOTKA AKTYWNA!";
        setTimeout(() => {
            player.powerUpActive = false;
            document.getElementById('status-msg').innerText = "";
        }, 5000);
    }

    function spawn() {
        const types = ['poop', 'poop', 'pee', 'paper', 'paper', 'air'];
        let type = types[Math.floor(Math.random() * types.length)];
        objects.push({
            x: Math.random() * (canvas.width - 60) + 30,
            y: canvas.height + 50,
            type: type,
            speed: 3 + (player.depth / 150)
        });
    }

    function update() {
        if (!gameRunning) return;

        if ((keys.KeyA || keys.ArrowLeft) && player.x > 0) player.x -= 7;
        if ((keys.KeyD || keys.ArrowRight) && player.x < canvas.width - player.w) player.x += 7;
        if ((keys.KeyW || keys.ArrowUp) && player.y > 50) player.y -= 5;
        if ((keys.KeyS || keys.ArrowDown) && player.y < canvas.height - 100) player.y += 5;

        player.oxygen -= 0.15;
        player.depth += 0.15;

        document.getElementById('score').innerText = player.score;
        document.getElementById('brushes').innerText = player.brushes;
        document.getElementById('depth').innerText = Math.floor(player.depth);
        document.getElementById('oxygen-bar').style.width = player.oxygen + "%";

        if (player.oxygen <= 0) finish(false, "Zabrak≈Ço tlenu...");
        if (Math.random() < 0.07) spawn();

        objects.forEach((obj, i) => {
            obj.y -= obj.speed;
            let dist = Math.hypot(player.x + 20 - obj.x, player.y + 30 - obj.y);
            if (dist < 38) {
                if (obj.type === 'poop' || obj.type === 'pee') {
                    if (player.powerUpActive) objects.splice(i, 1);
                    else finish(false, "Zderzenie z nieczysto≈õciami!");
                } else if (obj.type === 'paper') {
                    player.score++; objects.splice(i, 1);
                } else if (obj.type === 'air') {
                    player.oxygen = Math.min(100, player.oxygen + 20); objects.splice(i, 1);
                }
            }
            if (obj.y < -100) objects.splice(i, 1);
        });

        requestAnimationFrame(update);
    }

    function draw() {
        if (!gameRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Nurek
        ctx.fillStyle = player.powerUpActive ? '#00d4ff' : '#4CAF50';
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.fillStyle = '#222';
        ctx.fillRect(player.x + 5, player.y + 10, 30, 15);
        if(player.powerUpActive) {
            ctx.strokeStyle = 'gold'; ctx.lineWidth = 3;
            ctx.strokeRect(player.x - 5, player.y - 5, player.w + 10, player.h + 10);
        }

        objects.forEach(obj => drawFns[obj.type](obj.x, obj.y));
        requestAnimationFrame(draw);
    }

    function finish(win, msg) {
        gameRunning = false;
        document.getElementById('game-ui').style.display = 'none';
        const screen = document.getElementById('game-over-screen');
        screen.style.display = 'flex';
        document.getElementById('over-title').innerText = win ? "WYNURZONO SIƒò!" : "POCH≈ÅONIƒòTY!";
        document.getElementById('over-msg').innerHTML = `${msg || ""}<br>G≈Çƒôboko≈õƒá: ${Math.floor(player.depth)}m<br>Papier: ${player.score}`;
    }
</script>
</body>
</html>
