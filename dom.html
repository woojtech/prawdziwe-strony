<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Architekt Wnƒôtrz v5</title>
    <style>
        :root { --p-pink: #fce1e4; --p-white: #ffffff; --p-green: #e2f0cb; --p-blue: #d1e9ff; }
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        #start-screen { position: absolute; width: 100vw; height: 100vh; background: #1a1a2e; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        .menu-btn { background: #27ae60; color: white; border: none; padding: 15px 40px; border-radius: 30px; cursor: pointer; font-size: 20px; margin: 10px; transition: 0.3s; }
        .menu-btn:hover { background: #2ecc71; transform: scale(1.05); }

        #game-container { display: none; grid-template-columns: 320px 1fr; gap: 20px; width: 95vw; height: 90vh; background: #ecf0f1; padding: 20px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .panel { background: #fff; padding: 20px; border-radius: 15px; border: 1px solid #ddd; display: flex; flex-direction: column; }
        
        .stat-box { background: #f9f9f9; padding: 10px; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid #3498db; }
        #mailbox { background: #e74c3c; color: white; padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; border-bottom: 5px solid #c0392b; margin: 10px 0; }
        
        #house-canvas { position: relative; background: var(--p-pink); border: 10px solid #5d4037; border-radius: 10px; overflow: hidden; display: flex; justify-content: space-around; padding-top: 50px; }
        .window { width: 120px; height: 150px; background: #81d4fa; border: 6px solid #fff; box-shadow: inset 0 0 20px rgba(0,0,0,0.2); position: relative; border-radius: 5px; }
        .window::before { content: ''; position: absolute; top: 50%; width: 100%; height: 2px; background: #fff; }
        .window::after { content: ''; position: absolute; left: 50%; height: 100%; width: 2px; background: #fff; }

        .shelf { position: absolute; left: 10%; right: 10%; height: 15px; background: #8b4513; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); z-index: 5; }
        #shelf-1 { top: 250px; }
        #shelf-2 { top: 450px; }

        #trash-can { position: absolute; bottom: 15px; right: 15px; width: 80px; height: 80px; background: rgba(231, 76, 60, 0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 500; transition: 0.3s; }
        #trash-can.hovered { background: #e74c3c; transform: scale(1.2); }

        .item { position: absolute; font-size: 45px; cursor: grab; z-index: 10; user-select: none; }
        .item.dragging { opacity: 0.6; z-index: 1000; cursor: grabbing; }
        
        /* Styl dla przycisku gdy jest wy≈ÇƒÖczony (naprawa) */
        .buy-btn:disabled { 
            background: #bdc3c7 !important; /* Szary kolor dla wy≈ÇƒÖczonych przycisk√≥w */
            cursor: not-allowed !important; /* Kursor wskazujƒÖcy brak mo≈ºliwo≈õci klikniƒôcia */
        }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; margin: 5px; border: 2px solid #ddd; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>üè† Architekt Wnƒôtrz</h1>
    <div style="max-width: 400px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
        <p>Zbieraj monety ze skrzynki. Kupuj dekoracje i stawiaj je na p√≥≈Çkach. Sprzedawaj niechciane rzeczy w koszu za 50% ceny.</p>
    </div>
    <div id="menu-controls">
        <button class="menu-btn" onclick="startGame(false)">Rozpocznij NowƒÖ Grƒô</button>
        <button id="continue-btn" class="menu-btn" style="display:none;" onclick="startGame(true)">Kontynuuj OstatniƒÖ</button>
    </div>
</div>

<div id="game-container">
    <div class="panel">
        <div class="stat-box">
            üí∞ Portfel: <b id="balance">0</b><br>
            üìà Doch√≥d: +<b id="ips">2.0</b>/s
        </div>
        <div id="mailbox" onclick="collectCoins()">
            üì¨ SKRZYNKA<br><b id="pending">0</b> üí∞
        </div>
        <div id="shop" style="flex-grow: 1; overflow-y: auto;">
            <h4>Sklep</h4>
            <div id="shop-items"></div>
        </div>
        <h4>≈öciany:</h4>
        <div style="display: flex;">
            <div class="color-dot" style="background:#fce1e4" onclick="changeColor('#fce1e4')"></div>
            <div class="color-dot" style="background:#ffffff" onclick="changeColor('#ffffff')"></div>
            <div class="color-dot" style="background:#e2f0cb" onclick="changeColor('#e2f0cb')"></div>
            <div class="color-dot" style="background:#d1e9ff" onclick="changeColor('#d1e9ff')"></div>
        </div>
    </div>

    <div id="house-canvas">
        <div class="window"></div>
        <div class="window"></div>
        <div id="shelf-1" class="shelf"></div>
        <div id="shelf-2" class="shelf"></div>
        <div id="trash-can">üóëÔ∏è</div>
    </div>
</div>

<script>
    let state = { balance: 0, bonus: 0, items: [], color: '#fce1e4' };
    let pending = 0;
    let draggingItem = null;
    let initialX, initialY;

    const catalog = [
        { name: "Kwiatek", price: 100, icon: "ü™¥", inc: 0.5 },
        { name: "Zdjƒôcie", price: 240, icon: "üñºÔ∏è", inc: 1.2 },
        { name: "KsiƒÖ≈ºki", price: 500, icon: "üìö", inc: 3.0 },
        { name: "Lampa", price: 900, icon: "üí°", inc: 6.0 },
        { name: "Figurki", price: 1500, icon: "üß∏", inc: 12.0 },
        { name: "Z≈Çoty PosƒÖg", price: 3000, icon: "üóø", inc: 25.0 }
    ];

    window.onload = () => {
        if(localStorage.getItem('house_sim_v4')) {
            document.getElementById('continue-btn').style.display = 'inline-block';
        }
        // Upewniamy siƒô, ≈ºe ekran startowy jest widoczny przy ≈Çadowaniu
        document.getElementById('start-screen').style.display = 'flex'; 
    };

    function startGame(load) {
        if(load) {
            state = JSON.parse(localStorage.getItem('house_sim_v4'));
            state.items.forEach(it => createItemElement(it.icon, it.x, it.y, it.p, false));
            changeColor(state.color);
        } else {
            localStorage.clear();
            state = { balance: 0, bonus: 0, items: [], color: '#fce1e4' };
        }
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-container').style.display = 'grid';
        renderShop();
        gameLoop();
    }

    function renderShop() {
        const container = document.getElementById('shop-items');
        container.innerHTML = catalog.map((it, idx) => `
            <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px; align-items:center;">
                <span>${it.icon} ${it.name} (<b>${it.price}</b>)</span>
                <button id="buy-${idx}" class="buy-btn" onclick="buy(${idx})">Kup</button>
            </div>
        `).join('');
    }

    function gameLoop() {
        setInterval(() => {
            let totalIps = 2 + state.bonus;
            pending += totalIps;
            document.getElementById('pending').innerText = Math.floor(pending);
            document.getElementById('balance').innerText = Math.floor(state.balance);
            document.getElementById('ips').innerText = totalIps.toFixed(1);
            
            // Logika blokowania przycisk√≥w kupna (NAPRAWA)
            catalog.forEach((it, idx) => {
                const button = document.getElementById(`buy-${idx}`);
                if (button) {
                    button.disabled = state.balance < it.price;
                }
            });
            save();
        }, 1000); // Doch√≥d co 1 sekundƒô
    }
    // ... (pozosta≈Çe funkcje collectCoins, buy, createItemElement, changeColor, save, makeDraggable, drag, dragEnd pozostajƒÖ bez zmian w logice) ...
    
    function collectCoins() {
        state.balance += pending;
        pending = 0;
    }

    function buy(idx) {
        const it = catalog[idx];
        if(state.balance >= it.price) {
            state.balance -= it.price;
            state.bonus += it.inc;
            createItemElement(it.icon, 50, 200, it.price, true);
        }
    }

    function createItemElement(icon, x, y, price, isNew) {
        const el = document.createElement('div');
        el.className = 'item';
        el.innerText = icon;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.dataset.price = price;
        document.getElementById('house-canvas').appendChild(el);
        if(isNew) state.items.push({icon, x, y, p: price});
        makeDraggable(el);
    }

    function makeDraggable(el) {
        el.onmousedown = (e) => {
            draggingItem = el;
            initialX = e.clientX - el.offsetLeft;
            initialY = e.clientY - el.offsetTop;
            el.classList.add('dragging');
        };
    }

    document.onmousemove = (e) => {
        if (!draggingItem) return;
        let x = e.clientX - initialX;
        let y = e.clientY - initialY;
        draggingItem.style.left = x + "px";
        draggingItem.style.top = y + "px";

        const tRect = document.getElementById('trash-can').getBoundingClientRect();
        const iRect = draggingItem.getBoundingClientRect();
        if(iRect.right > tRect.left && iRect.left < tRect.right && iRect.bottom > tRect.top && iRect.top < tRect.bottom) {
            document.getElementById('trash-can').classList.add('hovered');
        } else {
            document.getElementById('trash-can').classList.remove('hovered');
        }
    };

    document.onmouseup = (e) => {
        if (!draggingItem) return;
        const trash = document.getElementById('trash-can');
        const tRect = trash.getBoundingClientRect();
        const iRect = draggingItem.getBoundingClientRect();

        if(iRect.right > tRect.left && iRect.left < tRect.right && iRect.bottom > tRect.top && iRect.top < tRect.bottom) {
            // Sprzeda≈º
            let refund = parseFloat(draggingItem.dataset.price) / 2;
            state.balance += refund;
            let icon = draggingItem.innerText;
            let catItem = catalog.find(c => c.icon === icon);
            if(catItem) state.bonus -= catItem.inc;
            
            state.items = state.items.filter(it => !(it.icon === icon && it.x === parseInt(draggingItem.style.left)));
            draggingItem.remove();
        } else {
            // P√≥≈Çki
            const shelves = [document.getElementById('shelf-1'), document.getElementById('shelf-2')];
            let placed = false;
            shelves.forEach(s => {
                const sRect = s.getBoundingClientRect();
                if(Math.abs(iRect.bottom - sRect.top) < 50 && iRect.left < sRect.right && iRect.right > sRect.left) {
                    draggingItem.style.top = (s.offsetTop - 55) + "px";
                    placed = true;
                }
            });
            if(!placed) draggingItem.style.top = "200px";
            
            const itemObj = state.items.find(it => it.icon === draggingItem.innerText && Math.abs(it.x - parseInt(draggingItem.style.left)) < 100);
            if(itemObj) { itemObj.x = parseInt(draggingItem.style.left); itemObj.y = parseInt(draggingItem.style.top); }
        }

        draggingItem.classList.remove('dragging');
        trash.classList.remove('hovered');
        draggingItem = null;
        save();
    };

    function changeColor(c) { document.getElementById('house-canvas').style.background = c; state.color = c; save(); }
    function save() { localStorage.setItem('house_sim_v4', JSON.stringify(state)); }
</script>
</body>
</html>
